\section{Stratified atmosphere initially at rest}
\label{sec:slanted:resting}

Diurnal valley and slope flows are associated with weak synoptic-scale winds, and cold air that sinks along sloping terrain can stagnate for days after becoming trapped in topographic basins \citep{chow2013}.
The test case by \citet{klemp2011} is an idealised representation of such phenomena, in which a wave-shaped mountain is submerged in a stably stratified atmosphere at rest in hydrostatic balance.
The analytic solution is time-invariant, but numerical errors in calculating pressure gradients can give rise to spurious flows which become stronger over steeper terrain \citep{klemp2011}.
Results are compared using terrain-following, cut cell and slanted cell meshes.

Following \cite{klemp2011}, the domain is \SI{200}{\kilo\meter} wide and \SI{20}{\kilo\meter} high, and the mesh spacing is \(\Delta x = \Delta z^\star = \SI{500}{\meter}\).  All boundary conditions are no normal flow.
The wave-shaped mountain profile has a surface height, $h$, given by
\begin{align}
	h(x) = h_0 \exp \left( - \left( \frac{x}{a} \right)^2 \right) \cos^2 \left( \alpha x \right) \label{eqn:resting:mountain}
\end{align}
where $a = \SI{5}{\kilo\meter}$ is the mountain half-width $\lambda = \SI{4}{\kilo\meter}$ is the wavelength and $h_0$ is the peak mountain height.  For the optimised SLEVE mesh, the coarse-scale component $h_1$ is specified as
\begin{align}
	h_1(x) = \frac{1}{2} h_0 \exp \left( - \left( \frac{x}{a} \right)^2 \right) \text{ .}
\end{align}
To accommodate a range of mountain heights we choose a coarse scale height $s_1 = \SI{20}{\kilo\meter}$ and a fine scale height $s_2 = \SI{8}{\kilo\meter}$.  Following \citet{leuenberger2010} the optimal exponent value of $n = \num{1.35}$ is used.  These parameter values result in a SLEVE mesh that is more distorted than the SLEVE mesh used by \citet{klemp2011}, but the choice is necessary to avoid mesh tangling with mountains higher than \SI{1}{\kilo\meter}.

The initial potential temperature field has a nonlinear vertical profile in the lower atmosphere, with $\theta(z = 0) = \SI{288}{\kelvin}$ and a constant static stability with Brunt-V\"ais\"al\"a frequency $N = \SI{0.01}{\per\second}$ everywhere, except for a more stable layer of $N = \SI{0.02}{\per\second}$ between $\SI{2}{\kilo\meter} \leq z \leq \SI{3}{\kilo\meter}$.
The Exner function of pressure is calculated so that it is in discrete hydrostatic balance in the vertical direction \citep{weller-shahrokhi2014}.

Momentum and potential temperature are transported using the cubicFit transport scheme.
The damping function \(\mu\) is set to \SI{0}{\per\second}.  Unlike \citet{klemp2011}, there is no eddy diffusion in the equation set.

\begin{figure}
	\centering
	\begin{subfigure}{\textwidth}
		\centering
		\input{slanted/resting/w}
		\phantomsubcaption\label{fig:slanted:resting:w:timeseries}
		\phantomsubcaption\label{fig:slanted:resting:w:max}
	\end{subfigure}
	\caption{Spurious vertical velocities in the resting atmosphere test using BTF, SLEVE, cut cell and slanted cell meshes.
	(\subcaptionref{fig:slanted:resting:w:timeseries}) Time series of spurious vertical velocities for a peak mountain height $h_0 = \SI{1}{\kilo\meter}$, with the maximum absolute value calculated at each time-step. 
	(\subcaptionref{fig:slanted:resting:w:max}) Sensitivity to peak mountain height $h_0$, with the maximum absolute value calculated across all time-steps.
	}
	\label{fig:slanted:resting:w}
\end{figure}

The test is integrated forward by \num{6} hours using a time-step of $\Delta t = \SI{25}{\second}$ on the BTF, SLEVE, cut cell and slanted cell meshes with a peak mountain height $h_0 = \SI{1}{\kilo\meter}$.
For each mesh, the maximum absolute vertical velocity is calculated at each time-step as a measure of the spurious flow generated by numerical errors.  In agreement with \citep{klemp2011}, magnitudes of vertical velocity peak shortly after integration begins and magnitudes are larger on more distorted meshes (figure~\ref{fig:slanted:resting:w:timeseries}).
However, magnitudes are much smaller comparing results on the terrain-following meshes with those from \citet{klemp2011}: results in figure~\ref{fig:slanted:resting:w:timeseries}, which use a curl-free pressure gradient formulation, have maximum absolute vertical velocities of \inputval{resting-btf-1000m-cubicFit/maxw}\unskip, compared with a maximum of $\sim \SI{7}{\meter\per\second}$ found by \citet{klemp2011} using their improved horizontal pressure gradient formulation.
The results on terrain-following meshes in figure~\ref{fig:slanted:resting:w:timeseries} have similar maximum errors as \citet{weller-shahrokhi2014} but, due to the more stable split into implicitly and explicitly treated terms (described in the appendix to \citet{shaw-weller2016}), the errors decay over time due to the dissipative nature of the transport scheme.
Unlike the result from \citet{klemp2011}, spurious flows are similar on both terrain-following meshes even though the SLEVE mesh is less distorted than the BTF mesh.

Compared to results on the terrain-following meshes, spurious flows are two orders of magnitude smaller on the cut cell mesh and the slanted cell mesh with a maximum absolute vertical velocity of $\sim \SI{1e-3}{\meter\per\second}$.
\citet{good2014} found the maximum vertical velocity in their cut cell model was \SI{1e-12}{\meter\per\second}, which is better than any result obtained here.  It is worth noting that our model stores values at the geometric centre of cut cells, whereas the model used by \citet{good2014} has cell centres at the centre of the uncut cell, resulting in the centre of some cut cells being below the ground (S.-J. Lock 2014, personal communication).
This means that the mesh is effectively regular when calculating horizontal and vertical gradients, and this would account for the very small velocities found by \citet{good2014}.

To evaluate the slanted cell method with steeper slopes, we perform a second series of tests with peak mountain heights ranging from $h_0 = \SI{0}{\kilo\meter}$ to $h_0 = \SI{6}{\kilo\meter}$.
The BTF, SLEVE, cut cell and slanted cell meshes with the largest peak mountain height of $h_0 = \SI{6}{\kilo\meter}$ are shown in figure~\ref{fig:slanted:resting:meshes}.
To obtain a single measure of spurious flow for a given mesh, the maximum absolute vertical velocity is calculated across all time-steps.
The most accurate results are obtained without mountains when $h_0 = \SI{0}{\kilo\meter}$ when all meshes become identical, with $\max(\Mag{w}) \sim \SI{1e-11}{\meter\per\second}$.
Using terrain-following meshes, the model becomes unstable beyond $h_0 = \SI{2}{\kilo\meter}$.
Using cut cell meshes, maximum vertical velocities are almost constant at $\sim \SI{0.5}{\meter\per\second}$ beyond $h_0 = \SI{1}{\kilo\meter}$ because cut cell mesh distortions are largely independent of mountain height.
Using slanted cell meshes, maximum vertical velocities are one to two orders of magnitude smaller than those found on terrain-following meshes at a given mountain height.  Unlike results on terrain-following meshes, slanted cell meshes yield stable results for all mountain heights, although maximum vertical velocities increase with peak mountain height as slanted cells become increasingly distorted.  Up to a peak mountain height of $h_0 = \SI{4}{\kilo\meter}$, slanted cell meshes produce results that are more accurate than those obtained for any other mesh.

In summary, spurious velocities in the resting atmosphere test were similar on both types of terrain-following mesh, with errors being much smaller compared to those from \citet{klemp2011}.
The maximum absolute vertical velocity was decreased by one to two orders of magnitude using cut cell and slanted cell meshes so we conclude that, in this test, mesh distortion, or lack of alignment of the mesh with surfaces of constant gravitational potential, is the primary cause of numerical error.
The resting atmosphere test presented a challenge to the pressure gradient formulation but the resultant spurious flows presented no particular challenge to the cubicFit transport scheme.  We will turn our attention to transport-dominated flow in the next chapter.
