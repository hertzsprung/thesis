\chapter{A new test case for exciting the Lorenz computational mode}
\label{ch:cp}

\begin{highlights}
{\Large Highlights}
\begin{itemize}
	\item A new idealised two-dimensional test case reveals spurious grid-scale waves excited by the Lorenz computational mode
	\item The Charney--Phillips staggering is generalised for arbitrary meshes that reduces to classical Charney--Phillips on traditional meshes
	\item A new fully compressible Euler model that implements the generalised Charney--Phillips formulation is free from spurious grid-scale waves
\end{itemize}
\end{highlights}

The Lorenz computational mode arises from having one too many degrees of freedom in the Lorenz staggering of variables, and it is often excited by thermal forcing, producing spurious, vertical, grid-scale waves \citep{schneider1987,arakawa-konor1996}.
In the Lorenz staggering, the pressure and vertical velocity variables are staggered, with the thermodynamic variable collocated with the pressure variable \citep{lorenz1960}.
Vertical averaging of the thermodynamic variable in calculating vertical momentum means that these grid-scale waves persist because they become invisible to the model \citep{arakawa-konor1996}.
Spurious grid-scale waves have been attributed to the Lorenz computational mode in the Global Environmental Multiscale 3 model \citep{girard2014}, and the Korea Institute of Atmospheric Prediction Systems Integrated Model \citep{yi-park2017} amongst others, and these non-physical waves can lead to spurious rainfall in atmospheric models \citep{hollingsworth1995}, inaccurate simulations of idealised hurricanes \citep{zhu-smith2003}, and spurious instabilities in ocean models \citep{bell-white2017}.

The computational mode can be at least partially controlled by using sufficient vertical diffusion \citep{chang1992,zadra2004}, or by using a higher-order vertical discretisation \citep{untch-hortal2004,guerra-ullrich2016,yi-park2017}, but the computational mode can only be properly eliminated by choosing an alternative staggering of variables that removes the extra degree of freedom.
One such alternative is the Charney--Phillips staggering \citep{charney-phillips1953}, in which the thermodynamic variable is collocated with vertical velocity, avoiding any vertical averaging in calculating vertical momentum.
Models that use a Charney--Phillips staggering include the Met Office Unified Model \citep{davies2005}, the Global Environmental Multiscale 4 model \citep{girard2014}, and the Global/Regional Assimilation and Prediction System \citep{yang2007}.
\citet{thuburn-woolings2005} exhaustively tested different combinations of vertical coordinates, prognostic variables and their staggerings, and found that a Charney--Phillips staggering has better dispersion properties than a Lorenz staggering for any given choice of vertical coordinate and prognostic variables.
Numerical experiments performed by \citet{cullen1997} revealed that a model with a Charney--Phillips staggering reduced spurious gravity waves and had better geostrophic adjustment compared to the same model with a Lorenz staggering.

While the Charney--Phillips staggering avoids vertical averaging of the thermodynamic variable in calculating vertical momentum, \citet{davies2005} notes that horizontal pressure gradient calculations can involve vertical averaging which is inaccurate in the lowest layers where there are strong temperature gradients.
\citet{holdaway2013a} note that, in calculating the Richardson number for boundary layer schemes, averaging that is necessary with the Charney--Phillips staggering that is avoided by using a Lorenz staggering.

Previous studies have used a variety of test cases to compare different model variants using Lorenz and Charney--Phillips staggering.
One of the earliest comparisons was made by \citet{arakawa-moorthi1988} who found that, without additional diffusion, their numerical solutions of a baroclinic instability test were dominated by short-wave noise.
Later, \citet{arakawa-konor1996} performed the same test to find that a model using a Charney--Phillips staggering did not suffer from spurious noise, with the model needing no additional diffusion.
In the same study, \citet{arakawa-konor1996} proposed new test cases that use thermal forcing to excite the Lorenz computational mode.
The new test cases were performed using an idealised, vertically discrete model and clearly reveal spurious grid-scale waves that grow and persist throughout the simulation.
Based on the work of \citet{arakawa-konor1996}, \citet{untch-hortal2004} developed a new test case, using thermal forcing to excite spurious grid-scale waves in a 600-day integration of a global, 3D model.

We propose a new, idealised two-dimensional test case, also based on the work of \citet{arakawa-konor1996}, to compare the accuracy of models using Lorenz or Charney--Phillips staggerings.  The new test case intended to aid in the development and intercomparison of modern, nonhydrostatic dynamical cores, and uses a coarse two-dimensional mesh specified in Cartesian coordinates.
We compare test results between the fully compressible Euler model with a Lorenz staggering (section~\ref{sec:slanted:exnerFoamH}), and a variant of this same model that includes a new generalisation of the Charney--Phillips staggering for arbitrary meshes.

After describing the generalised Charney--Phillips formulation in section~\ref{sec:cp:method}, we compare Lorenz and generalised Charney--Phillips model variants in section~\ref{sec:cp:schaerWaves} using the standard mountain waves test case specified by \citet{schaer2002}.
Section~\ref{sec:cp:arakawaKonor} presents the new test case based on \citet{arakawa-konor1996}. We verify that the Lorenz computational mode is excited using the fully compressible Euler model with a Lorenz staggering.  Using the generalised Charney--Phillips model variant, the sensitivity to mesh distortions is explored.  Finally, in section~\ref{sec:cp:advection}, we extract the transport scheme from the generalised Charney--Phillips model variant and examine numerical errors using transport tests on distorted and undistorted meshes.

\input{cp/method.tex}
\input{cp/schaerWaves.tex}
\input{cp/arakawaKonor.tex}

\section{Horizontal transport on distorted Charney--Phillips meshes}
\label{sec:cp:advection}
\TODO{
\begin{itemize}
	\item Test: horizontal advection; advectiveFoamF, advectionFoam with linear interp, advectionFoam with linearUpwind interp; measure l2 and linf errors (s.t. they can be compared with cell-centred, C-grid results); uniform and edgeGraded meshes
	\item Plot: error fields, analytic+numerical contours of final solution, which schemes and which meshes? too many combinations to plot all of them
	\item Plot: time-series of conservation, ExnerFoamH and ExnerFoamCP, uniform mesh, horizontal edgeGrading, vertical edgeGrading
	\item Conclusion: advection is conservative on uniform meshes, non-conservative on non-uniform meshes
	\item Conclusion: advectiveFoamF errors are comparable to advectionFoam with linear interpolation?
	\item Conclusion: advectiveFoamF errors are worse than advectionFoam with linearUpwind interpolation?
\end{itemize}
}

